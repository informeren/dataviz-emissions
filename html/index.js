(function(e){function n(e,t,n){var r=d3.select("#stacked").append("svg").attr("width",e+n.left+n.right).attr("height",t+n.top+n.bottom).append("g").attr("transform","translate("+n.left+","+n.top+")").attr("id","wrapper");r.insert("g").attr("class","x axis");r.insert("g").attr("class","y axis")}function r(e,t,n){var r=d3.scale.ordinal().rangeRoundBands([0,t],.1),i=d3.scale.linear().range([n,0]),s=d3.svg.axis().scale(r).innerTickSize(0).outerTickSize(0).orient("bottom"),o=d3.svg.axis().scale(i).innerTickSize(0).outerTickSize(0).tickPadding(0).orient("left").ticks(5,"d").tickFormat(d3.format(".2s")),u=["co2","ch4","no","gwp"],a=d3.scale.ordinal().range(["#252525","#d00","#737373","#969696"]);a.domain(u);var f=d3.scale.ordinal().rangePoints([0,11]);f.domain([2e3,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011]);d3.json("./emissions/type/"+e+".json",function(e,t){if(e)return console.warn(e);var l=[];for(var c in t)a.domain().forEach(function(e){typeof l[u.indexOf(e)]=="undefined"&&(l[u.indexOf(e)]=[]);l[u.indexOf(e)].push({x:f(c),y:t[c][e],year:c,name:e})});l=d3.layout.stack()(l);r.domain(l[0].map(function(e){return e.year}));i.domain([0,d3.max(l,function(e){return d3.max(e,function(e){return e.y+e.y0})})]);var h=d3.select("#wrapper"),p=h.selectAll("g.layer").data(l);p.enter().append("g").style("fill",function(e,t){return a(t)}).attr("class","layer");var d=p.selectAll("rect.stacked").data(function(e){return e});d.enter().append("rect").attr("class","stacked").attr("width",r.rangeBand()).attr("x",function(e){return r(e.year)}).attr("y",350).attr("height",0);d.transition().delay(function(e,t){return t*20}).duration(300).ease("quad").attr("y",function(e){return i(e.y)+i(e.y0)-n}).attr("height",function(e){return n-i(e.y)});h.select(".x.axis").attr("transform","translate(0, "+n+")").call(s);h.select(".y.axis").transition().duration(300).ease("quad").call(o);legend=h.selectAll(".legend").data(u).enter().append("g").attr("class","legend").attr("transform",function(e,t){return"translate(0,"+t*20+")"});legend.append("rect").attr("x",862).attr("width",18).attr("height",18).style("fill",a);legend.append("text").attr("x",856).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(e){return e})})}var t={};t={margin:{top:20,right:60,bottom:30,left:40},width:840,height:350};e(function(){e("#filter").change(function(){var e=this.value;r(e,t.width,t.height)});n(t.width,t.height,t.margin);e("#filter").change()})})(jQuery);