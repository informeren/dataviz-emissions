(function(e){function n(e,t,n,r){var i=d3.select("#"+e).append("svg").attr("width",t+r.left+r.right).attr("height",n+r.top+r.bottom).append("g").attr("transform","translate("+r.left+","+r.top+")").attr("id",e+"-wrapper");i.insert("g").attr("class","x axis");i.insert("g").attr("class","y axis")}function r(e,t,n,r,i){var s=d3.scale.ordinal().rangeRoundBands([0,r],.1),o=d3.scale.linear().range([i,0]),u=d3.svg.axis().scale(s).innerTickSize(0).outerTickSize(0).orient("bottom"),a=d3.svg.axis().scale(o).innerTickSize(0).outerTickSize(0).tickPadding(0).orient("left").ticks(5,"d").tickFormat(d3.format(".2s")),f=d3.scale.ordinal().range(["#252525","#d00"]);f.domain(t);var l=d3.scale.ordinal().rangePoints([0,11]);l.domain([2e3,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011]);d3.json("./emissions/type/"+n+".json",function(n,r){if(n)return console.warn(n);var c=[];for(var h in r)f.domain().forEach(function(e){typeof c[t.indexOf(e)]=="undefined"&&(c[t.indexOf(e)]=[]);c[t.indexOf(e)].push({x:l(h),y:r[h][e],year:h,name:e})});c=d3.layout.stack()(c);s.domain(c[0].map(function(e){return e.year}));o.domain([0,d3.max(c,function(e){return d3.max(e,function(e){return e.y+e.y0})})]);var p=d3.select("#"+e+"-wrapper"),d=p.selectAll("g.layer").data(c);d.enter().append("g").style("fill",function(e,t){return f(t)}).attr("class","layer");var v=d.selectAll("rect.stacked").data(function(e){return e});v.enter().append("rect").attr("class","stacked").attr("width",s.rangeBand()).attr("x",function(e){return s(e.year)}).attr("y",350).attr("height",0);v.transition().delay(function(e,t){return t*20}).duration(300).ease("quad").attr("y",function(e){return o(e.y)+o(e.y0)-i}).attr("height",function(e){return i-o(e.y)});p.select(".x.axis").attr("transform","translate(0, "+i+")").call(u);p.select(".y.axis").transition().duration(300).ease("quad").call(a);legend=p.selectAll(".legend").data(t).enter().append("g").attr("class","legend").attr("transform",function(e,t){return"translate(0,"+t*20+")"});legend.append("rect").attr("x",862).attr("width",18).attr("height",18).style("fill",f);legend.append("text").attr("x",856).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(e){return e})})}var t={};t={margin:{top:20,right:60,bottom:30,left:40},width:840,height:150};e(function(){e("#filter").change(function(){var e=this.value;r("stacked-co2-gwp",["co2","gwp"],e,t.width,t.height);r("stacked-ch4-no",["ch4","no"],e,t.width,t.height)});n("stacked-co2-gwp",t.width,t.height,t.margin);n("stacked-ch4-no",t.width,t.height,t.margin);e("#filter").change()})})(jQuery);