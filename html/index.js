(function(e){function n(e,t,n){var r=d3.select("#stacked").append("svg").attr("width",e+n.left+n.right).attr("height",t+n.top+n.bottom).append("g").attr("transform","translate("+n.left+","+n.top+")").attr("id","wrapper");r.insert("g").attr("class","x axis");r.insert("g").attr("class","y axis")}function r(t,n,r){var i=d3.scale.ordinal().rangeRoundBands([0,n],.1),s=d3.scale.linear().rangeRound([r,0]),o=d3.scale.ordinal().range(["#252525","#d00","#737373","#969696"]),u=d3.svg.axis().scale(i).innerTickSize(0).outerTickSize(0).orient("bottom"),a=d3.svg.axis().scale(s).innerTickSize(0).outerTickSize(0).tickPadding(0).orient("left").ticks(5,"d").tickFormat(d3.format(".2s"));d3.json("./emissions/type/"+t+".json",function(t,n){if(t)return console.warn(t);o.domain(["co2","ch4","no","gwp"]);var f=new Array;e.each(n,function(e,t){prev=0;var n=o.domain().map(function(n){return{year:e,name:n,y:prev,y1:prev+=+t[n]}});f.push(n)});i.domain(f.map(function(e){return e[0].year}));s.domain([0,d3.max(f,function(e){return e[3].y1})]);var l=d3.select("#wrapper"),c=l.selectAll("g.wrapper").data(f,function(e){return f.indexOf(e)});c.enter().append("g").attr("class","wrapper").attr("transform",function(e){return"translate("+i(e[0].year)+",0)"}).attr("y",0).attr("width",i.rangeBand()).attr("height",r).attr("fill","#feddef");c.exit().remove();c.transition().duration(7e3).ease("exp").attr("width",i.rangeBand());var h=c.selectAll("rect.wrapper").data(function(e){return e});h.enter().append("rect").attr("class","sub").attr("width",i.rangeBand()).attr("y",function(e){return s(e.y1)}).attr("height",function(e){return s(e.y)-s(e.y1)}).style("fill",function(e){return o(e.name)});h.exit().remove();h.transition().duration(7e3).ease("exp").attr("width",i.rangeBand());l.select(".x.axis").attr("transform","translate(0, "+r+")").call(u);l.select(".y.axis").transition().duration(300).ease("exp").call(a);legend=l.selectAll(".legend").data(o.domain().slice().reverse()).enter().append("g").attr("class","legend").attr("transform",function(e,t){return"translate(0,"+t*20+")"});legend.append("rect").attr("x",862).attr("width",18).attr("height",18).style("fill",o);legend.append("text").attr("x",856).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(e){return e})})}var t=new Object;t={margin:{top:20,right:60,bottom:30,left:40},width:840,height:350};e(function(){e("#filter").change(function(){var e=this.value;r(e,t.width,t.height)});n(t.width,t.height,t.margin);e("#filter").change()})})(jQuery);+function(e){"use strict";var t=function(n,r){this.$element=e(n);this.options=e.extend({},t.DEFAULTS,r);this.transitioning=null;this.options.parent&&(this.$parent=e(this.options.parent));this.options.toggle&&this.toggle()};t.DEFAULTS={toggle:!0};t.prototype.dimension=function(){var e=this.$element.hasClass("width");return e?"width":"height"};t.prototype.show=function(){if(this.transitioning||this.$element.hasClass("in"))return;var t=e.Event("show.bs.collapse");this.$element.trigger(t);if(t.isDefaultPrevented())return;var n=this.$parent&&this.$parent.find("> .panel > .in");if(n&&n.length){var r=n.data("bs.collapse");if(r&&r.transitioning)return;n.collapse("hide");r||n.data("bs.collapse",null)}var i=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[i](0);this.transitioning=1;var s=function(){this.$element.removeClass("collapsing").addClass("collapse in")[i]("auto");this.transitioning=0;this.$element.trigger("shown.bs.collapse")};if(!e.support.transition)return s.call(this);var o=e.camelCase(["scroll",i].join("-"));this.$element.one(e.support.transition.end,e.proxy(s,this)).emulateTransitionEnd(350)[i](this.$element[0][o])};t.prototype.hide=function(){if(this.transitioning||!this.$element.hasClass("in"))return;var t=e.Event("hide.bs.collapse");this.$element.trigger(t);if(t.isDefaultPrevented())return;var n=this.dimension();this.$element[n](this.$element[n]())[0].offsetHeight;this.$element.addClass("collapsing").removeClass("collapse").removeClass("in");this.transitioning=1;var r=function(){this.transitioning=0;this.$element.trigger("hidden.bs.collapse").removeClass("collapsing").addClass("collapse")};if(!e.support.transition)return r.call(this);this.$element[n](0).one(e.support.transition.end,e.proxy(r,this)).emulateTransitionEnd(350)};t.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()};var n=e.fn.collapse;e.fn.collapse=function(n){return this.each(function(){var r=e(this),i=r.data("bs.collapse"),s=e.extend({},t.DEFAULTS,r.data(),typeof n=="object"&&n);!i&&s.toggle&&n=="show"&&(n=!n);i||r.data("bs.collapse",i=new t(this,s));typeof n=="string"&&i[n]()})};e.fn.collapse.Constructor=t;e.fn.collapse.noConflict=function(){e.fn.collapse=n;return this};e(document).on("click.bs.collapse.data-api","[data-toggle=collapse]",function(t){var n=e(this),r,i=n.attr("data-target")||t.preventDefault()||(r=n.attr("href"))&&r.replace(/.*(?=#[^\s]+$)/,""),s=e(i),o=s.data("bs.collapse"),u=o?"toggle":n.data(),a=n.attr("data-parent"),f=a&&e(a);if(!o||!o.transitioning){f&&f.find('[data-toggle=collapse][data-parent="'+a+'"]').not(n).addClass("collapsed");n[s.hasClass("in")?"addClass":"removeClass"]("collapsed")}s.collapse(u)})}(jQuery);+function(e){"use strict";function i(r){e(t).remove();e(n).each(function(){var t=s(e(this)),n={relatedTarget:this};if(!t.hasClass("open"))return;t.trigger(r=e.Event("hide.bs.dropdown",n));if(r.isDefaultPrevented())return;t.removeClass("open").trigger("hidden.bs.dropdown",n)})}function s(t){var n=t.attr("data-target");if(!n){n=t.attr("href");n=n&&/#[A-Za-z]/.test(n)&&n.replace(/.*(?=#[^\s]*$)/,"")}var r=n&&e(n);return r&&r.length?r:t.parent()}var t=".dropdown-backdrop",n="[data-toggle=dropdown]",r=function(t){e(t).on("click.bs.dropdown",this.toggle)};r.prototype.toggle=function(t){var n=e(this);if(n.is(".disabled, :disabled"))return;var r=s(n),o=r.hasClass("open");i();if(!o){"ontouchstart"in document.documentElement&&!r.closest(".navbar-nav").length&&e('<div class="dropdown-backdrop"/>').insertAfter(e(this)).on("click",i);var u={relatedTarget:this};r.trigger(t=e.Event("show.bs.dropdown",u));if(t.isDefaultPrevented())return;r.toggleClass("open").trigger("shown.bs.dropdown",u);n.focus()}return!1};r.prototype.keydown=function(t){if(!/(38|40|27)/.test(t.keyCode))return;var r=e(this);t.preventDefault();t.stopPropagation();if(r.is(".disabled, :disabled"))return;var i=s(r),o=i.hasClass("open");if(!o||o&&t.keyCode==27){t.which==27&&i.find(n).focus();return r.click()}var u=" li:not(.divider):visible a",a=i.find("[role=menu]"+u+", [role=listbox]"+u);if(!a.length)return;var f=a.index(a.filter(":focus"));t.keyCode==38&&f>0&&f--;t.keyCode==40&&f<a.length-1&&f++;~f||(f=0);a.eq(f).focus()};var o=e.fn.dropdown;e.fn.dropdown=function(t){return this.each(function(){var n=e(this),i=n.data("bs.dropdown");i||n.data("bs.dropdown",i=new r(this));typeof t=="string"&&i[t].call(n)})};e.fn.dropdown.Constructor=r;e.fn.dropdown.noConflict=function(){e.fn.dropdown=o;return this};e(document).on("click.bs.dropdown.data-api",i).on("click.bs.dropdown.data-api",".dropdown form",function(e){e.stopPropagation()}).on("click.bs.dropdown.data-api",n,r.prototype.toggle).on("keydown.bs.dropdown.data-api",n+", [role=menu], [role=listbox]",r.prototype.keydown)}(jQuery);